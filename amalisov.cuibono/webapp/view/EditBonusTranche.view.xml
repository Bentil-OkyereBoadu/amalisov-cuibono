<mvc:View
    controllerName="amalisov.cuibono.controller.EditBonusTranche"
    displayBlock="true"
    xmlns="sap.m"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    core:require="{
		formatter: 'amalisov/cuibono/model/formatter'
	}"
    xmlns:f="sap.ui.layout.form"
>
    <Page
        id="page"
        showNavButton="true"
        navButtonPress=".onNavBack"
        title="{i18n>createTrancheTitle}"
        floatingFooter="true"
    >
        <IconTabHeader mode="Inline">
            <items>
                <IconTabFilter text="{i18n>details}" />
            </items>
        </IconTabHeader>

        <content>
            <f:SimpleForm
                class="form"
                editable="true"
                layout="ResponsiveGridLayout"
                labelSpanL="2"
                labelSpanM="2"
                emptySpanL="2"
                emptySpanM="2"
            >
                <f:content>
                    <VBox class="formBox">
                        <VBox class="tranchItems">
                            <Label text="{i18n>Status}" />
                            <Text
                                text="{updateModel>/Status}"
                                id="statusValue"
                            />
                        </VBox>
                        <HBox class="formRows firstRow">
                            <VBox class="tranchItems">
                                <Label
                                    text="{i18n>trancheName}"
                                    required="true"
                                />
                                <Input
                                    id="nameInput"
                                    required="true"
                                    value="{updateModel>/name}"
                                    type="Text"
                                    class="sapUiSmallMarginBottom inputs textInput"
                                />
                            </VBox>

                            <VBox class="tranchItems">
                                <Label
                                    text="{i18n>trancheLocation}"
                                    required="true"
                                />
                                <Select
                                    selectedKey="{updateModel>/location}"
                                    class="inputs"
                                    id="locationSelect"
                                >
                                    <core:ListItem
                                        key="{i18n>location1}"
                                        text="{i18n>location1}"
                                    />
                                    <core:ListItem
                                        key="{i18n>location2}"
                                        text="{i18n>location2}"
                                    />
                                    <core:ListItem
                                        key="{i18n>location3}"
                                        text="{i18n>location3}"
                                    />
                                    <core:Item
                                        key="{i18n>location4}"
                                        text="{i18n>location4}"
                                    />
                                    <core:Item
                                        key="{i18n>location5}"
                                        text="{i18n>location5}"
                                    />
                                </Select>
                            </VBox>
                        </HBox>

                        <VBox class="tranchItems">
                            <Label text="{i18n>trancheDescription}" />
                            <TextArea
                                id="descriptionInput"
                                value="{updateModel>/description}"
                                rows="4"
                                class="sapUiSmallMarginBottom textArea"
                            />
                        </VBox>

                        <HBox class="formRows">
                            <VBox class="tranchItems">
                                <Label
                                    text="{i18n>startDate}"
                                    required="true"
                                />
                                <DatePicker
                                    id="startDateInput"
                                    placeholder="{i18n>datePlaceholder}"
                                    value="{updateModel>/startDate}"
                                    liveChange=".limitEndDate"
                                    change=".limitDates"
                                    required="true"
                                    class="sapUiSmallMarginBottom inputs"
                                />
                            </VBox>

                            <VBox class="tranchItems">
                                <Label
                                    text="{i18n>endDate}"
                                    required="true"
                                />
                                <DatePicker
                                    id="endDateInput"
                                    placeholder="{i18n>datePlaceholder}"
                                    required="true"
                                    value="{updateModel>/endDate}"
                                    class="sapUiSmallMarginBottom inputs"
                                    change=".limitDates"
                                />
                            </VBox>
                        </HBox>

                        <HBox class="formRows">
                            <VBox class="tranchItems">
                                <Label text="{i18n>trancheWeight}" />
                                <Input
                                    id="weightInput"
                                    type="Text"
                                    value="{updateModel>/weight}"
                                    class="sapUiSmallMarginBottom inputs textInput"
                                />
                            </VBox>

                            <VBox class="tranchItems">
                                <Label text="{i18n>originDate}" />
                                <DatePicker
                                    id="originDateInput"
                                    placeholder="{i18n>datePlaceholder}"
                                    change=".limitDates"
                                    value="{formatter: 'formatter.formatDate', path: 'updateModel>/originDate'}"
                                    class="sapUiSmallMarginBottom inputs"
                                />
                            </VBox>
                        </HBox>
                    </VBox>
                </f:content>
            </f:SimpleForm>

            <!-- Table -->

            <Panel class="tablePanel">
                <Table
                    items="{updateModel>/targets}"
                    id="trancheTable"
                    width="45%"
                >
                    <headerToolbar>
                        <Toolbar class="sapUiSmallMarginBottom">
                            <Title text="{i18n>targets}" />
                            <ToolbarSpacer />
                            <Button
                                type="Accept"
                                text="{i18n>newTarget}"
                                press=".onAddTarget"
                                class="btn"
                            />
                        </Toolbar>
                    </headerToolbar>
                    <columns>
                        <Column>
                            <Label text="{i18n>trancheName}" />
                        </Column>
                        <Column>
                            <Label text="{i18n>targetWeight}" />
                        </Column>
                        <Column>
                            <Label text="{i18n>targetAchievement}" />
                        </Column>
                        <Column width="10%" />
                    </columns>

                    <items>
                        <ColumnListItem>
                            <Text text="{updateModel>name}" />
                            <Text text="{updateModel>weight}" />
                            <Text text="{updateModel>achievement}" />
                            <HBox class="interactionIcons">
                                <core:Icon
                                    src="sap-icon://edit"
                                    class="icon"
                                    press=".onOpenEditTarget"
                                />

                                <core:Icon
                                    src="sap-icon://delete"
                                    press=".onDeleteTarget"
                                    class="icon"
                                />
                            </HBox>
                        </ColumnListItem>
                    </items>
                </Table>
                <Table width="45%">
                    <columns>
                        <Column>
                  
                        </Column>
                    </columns>
                    <items>
                        <ColumnListItem>
                            <HBox class="total">
                               <Label text="{i18n>total}" class="boldText"/>
                               <HBox>
                                    <Button
                                        type="Reject"
                                        icon=" sap-icon://alert"
                                        visible="{path: 'totalWeightModel>/totalWeight', formatter: 'formatter.totalWeight', targetType:'any'}"
                                    />
                                  <Text text="{totalWeightModel>/totalWeight}" class="totalWeight"/> 
                               </HBox>
                            </HBox>
                        </ColumnListItem>
                    </items>
                </Table>
            </Panel>
            <!--  END OF TABLE -->

            <core:Fragment
                fragmentName="amalisov.cuibono.view.fragments.AddTarget"
                type="XML"
            />
        </content>
        <footer>
            <OverflowToolbar>
                <ToolbarSpacer />
                <Button
                    type="Accept"
                    text="{i18n>save}"
                    press=".onSaveTranche"
                    icon="sap-icon://save"
                    visible="{parts: [{path: 'updateModel>/Status'}, {path: 'totalWeightModel>/totalWeight'}], formatter: 'formatter.saveVisibility'}"
                />
                <Button
                    type="Ghost"
                    text="{i18n>lock}"
                    icon="sap-icon://locked"
                    press=".onLockTranche"
                    visible="{parts: [{path: 'updateModel>/Status'}, {path: 'totalWeightModel>/totalWeight'}], formatter: 'formatter.lockVisibility'}"
                />
                <Button
                    type="Accept"
                    text="{i18n>completedStatus}"
                    icon="sap-icon://complete"
                    press=".onSaveTranche"
                    visible="{path: 'updateModel>/Status', formatter: 'formatter.showComplete', targetType:'any'}"
                />
                <Button
                    type="Ghost"
                    text="{i18n>reopen}"
                    icon="sap-icon://unlocked"
                    press=".onSaveTranche"
                    visible="{path: 'updateModel>/Status', formatter: 'formatter.showComplete', targetType:'any'}"
                />
                <Button
                    type="Reject"
                    press=".onNavBack"
                    text="Cancel"
                />
            </OverflowToolbar>
        </footer>
    </Page>
</mvc:View>
